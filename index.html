<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù…Ø§Ù‡Ø±Ø§Ø¯ Û³Û¶Û° - Û±Û´Û°Ûµ</title>
  <!-- favicon Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯ ØªØ§ 404 Ù†Ø¯Ù‡ -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸš€</text></svg>">
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jalaali-js@1.2.6/dist/jalaali.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700;900&display=swap" rel="stylesheet">
  <style>
    body{background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff;font-family:'Vazirmatn',sans-serif;min-height:100vh}
    .glass{background:rgba(255,255,255,0.1);backdrop-filter:blur(20px);border-radius:25px;border:1px solid rgba(255,255,255,0.2);box-shadow:0 20px 50px rgba(0,0,0,0.3)}
    .card{background:rgba(255,255,255,0.15);backdrop-filter:blur(15px);border-radius:20px;border:none;transition:.3s}
    .card:hover{transform:translateY(-8px)}
    .grade-circle{width:140px;height:140px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:4.5rem;font-weight:900;box-shadow:0 0 40px}
    .A{background:#10b981;box-shadow:0 0 40px #10b98180}
    .B{background:#3b82f6;box-shadow:0 0 40px #3b82f680}
    .C{background:#fbbf24;box-shadow:0 0 40px #fbbf2480}
    .D{background:#f97316;box-shadow:0 0 40px #f9731680}
    .E{background:#ef4444;box-shadow:0 0 40px #ef444480}
    .progress-ring{position:relative;width:160px;height:160px}
    .progress-ring svg{transform:rotate(-90deg)}
    .progress-ring circle{fill:none;stroke:#334155;stroke-width:14}
    .progress-ring .bar{stroke:#10b981;stroke-linecap:round;stroke-width:14;transition:.8s}
    .progress-ring .text{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:2.2rem;font-weight:900}
    .shamsi{font-size:2.8rem;font-weight:900;background:linear-gradient(45deg,#fff,#a78bfa);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .radar-canvas{background:rgba(255,255,255,0.1);border-radius:20px;padding:20px}
  </style>
</head>
<body class="p-3">

<div id="app" class="container py-4">
  <div v-if="!user" class="d-flex align-items-center justify-content-center min-vh-100">
    <div class="glass p-5 text-center" style="max-width:420px">
      <h1 class="display-4 fw-bold mb-4">Ù…Ø§Ù‡Ø±Ø§Ø¯ Û³Û¶Û°</h1>
      <input v-model="code" @keyup.enter="login" class="form-control form-control-lg text-center mb-4 fs-3" placeholder="Ú©Ø¯ Ù¾Ø±Ø³Ù†Ù„ÛŒ" autofocus>
      <button @click="login" class="btn btn-light btn-lg w-100 fs-4">ÙˆØ±ÙˆØ¯</button>
      <small class="d-block mt-3">Ù…Ø¯ÛŒØ±: admin</small>
    </div>
  </div>

  <div v-else class="glass p-5">
    <div class="d-flex justify-content-between align-items-center mb-5">
      <div><h1 class="shamsi">{{shamsiDate}}</h1><h3>Ø³Ø§Ù…Ø§Ù†Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª Ø¹Ù…Ù„Ú©Ø±Ø¯ Ú©Ø§Ø±Ú©Ù†Ø§Ù†</h3></div>
      <button @click="user=null" class="btn btn-outline-light">Ø®Ø±ÙˆØ¬</button>
    </div>

    <div class="row g-4 mb-5 text-center">
      <div class="col-md-3"><div class="card p-4"><h5>ØªÚ©Ù…ÛŒÙ„ Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ</h5>
        <div class="progress-ring mx-auto"><svg width="160" height="160"><circle cx="80" cy="80" r="72"/><circle cx="80" cy="80" r="72" class="bar" :stroke-dasharray="c" :stroke-dashoffset="o"/></svg><div class="text">{{percent}}%</div></div>
      </div></div>
      <div class="col-md-3"><div class="card p-4"><h5>Ù¾Ø§Ø¯Ø§Ø´ Ø³Ù‡â€ŒÙ…Ø§Ù‡Ù‡</h5><h2 class="text-warning">{{bonus.toLocaleString('fa-IR')}} ØªÙˆÙ…Ø§Ù†</h2></div></div>
      <div class="col-md-3"><div class="card p-4"><h5>Ú¯Ø±ÛŒØ¯ Ø¹Ù…Ù„Ú©Ø±Ø¯</h5><div class="grade-circle mx-auto" :class="grade">{{grade}}</div></div></div>
      <div class="col-md-3"><div class="card p-4"><h5>Ø§Ù…ØªÛŒØ§Ø² Ú©Ù„</h5><h2>{{avg.toFixed(2)}} / Ûµ.Û°Û°</h2></div></div>
    </div>

    <div class="row">
      <div class="col-lg-8"><div class="card p-4 radar-canvas"><h4 class="text-center mb-4">Ù†Ù…ÙˆØ¯Ø§Ø± Ø¹Ù…Ù„Ú©Ø±Ø¯ Û³Û¶Û° Ø¯Ø±Ø¬Ù‡</h4>
        <canvas ref="radar" height="420"></canvas>
        <div class="text-center mt-3"><span class="badge bg-primary fs-6">Ø¹Ù…Ù„Ú©Ø±Ø¯ ÙØ¹Ù„ÛŒ</span> <span class="badge bg-danger fs-6">Ù‡Ø¯Ù</span></div>
      </div></div>
      <div class="col-lg-4"><div class="card p-4"><h5>Ø§Ù‡Ø¯Ø§Ù Ø¯ÙˆØ±Ù‡ Ø¬Ø§Ø±ÛŒ</h5>
        <ul class="list-group list-group-flush text-white">
          <li class="list-group-item bg-transparent d-flex justify-content-between">Ø§ÙØ²Ø§ÛŒØ´ ÙØ±ÙˆØ´ Û±ÛµÙª <span class="text-success">Ø¯Ø± Ø¬Ø±ÛŒØ§Ù†</span></li>
          <li class="list-group-item bg-transparent d-flex justify-content-between">Ú©Ø§Ù‡Ø´ Ø²Ù…Ø§Ù† Ù¾Ø§Ø³Ø®Ú¯ÙˆÛŒÛŒ <span class="text-success">ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡</span></li>
          <li class="list-group-item bg-transparent d-flex justify-content-between">Ø¯ÙˆØ±Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø±ÙˆÚ˜Ù‡ <span class="text-warning">Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù…</span></li>
        </ul>
      </div></div>
    </div>

    <ul class="nav nav-tabs mt-5 mb-4">
      <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#eval">Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Û³Û¶Û°</a></li>
      <li v-if="isAdmin" class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#admin">Ù…Ø¯ÛŒØ±ÛŒØª</a></li>
    </ul>

    <div class="tab-content">
      <div class="tab-pane active" id="eval" class="card p-4">
        <select v-model="target" class="form-select form-select-lg mb-4">
          <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ù‡Ù…Ú©Ø§Ø± Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ</option>
          <option v-for="p in people" :value="p">{{p.name}} - {{p.dept}}</option>
        </select>
        <div v-if="target" class="row g-3">
          <div class="col-md-6" v-for="(q,i) in questions" :key="i">
            <label class="form-label">{{q}}</label>
            <input type="range" class="form-range" min="1" max="5" v-model.number="scores[i]" @input="e=>e.target.style.background=`linear-gradient(to right,#ef4444 ${(scores[i]-1)*25}%,#10b981 ${(scores[i]-1)*25}%)`">
            <div class="d-flex justify-content-between"><small>Ø¶Ø¹ÛŒÙ</small><strong>{{scores[i]}}</strong><small>Ø¹Ø§Ù„ÛŒ</small></div>
          </div>
        </div>
        <button v-if="target" @click="submit" class="btn btn-success btn-lg w-100 mt-4">Ø§Ø±Ø³Ø§Ù„ Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ</button>
      </div>

      <div v-if="isAdmin" class="tab-pane" id="admin">
        <button @click="exportExcel" class="btn btn-light mb-3">Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú¯Ø²Ø§Ø±Ø´ Ø§Ú©Ø³Ù„</button>
        <input type="file" @change="importExcel" accept=".xlsx" class="form-control mb-3">
        <div class="table-responsive">
          <table class="table table-dark text-center">
            <thead><tr><th>Ù†Ø§Ù…</th><th>ÙˆØ§Ø­Ø¯</th><th>ØªØ¹Ø¯Ø§Ø¯ Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ</th><th>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†</th><th>Ú¯Ø±ÛŒØ¯</th></tr></thead>
            <tbody>
              <tr v-for="p in people">
                <td>{{p.name}}</td><td>{{p.dept}}</td><td>{{p.evals?.length||0}}</td><td>{{calcAvg(p).toFixed(2)}}</td>
                <td><div class="grade-circle mx-auto" :class="calcGrade(calcAvg(p))" style="width:60px;height:60px;font-size:2rem">{{calcGrade(calcAvg(p))}}</div></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
const {createApp,ref,onMounted,computed}=Vue; let chart=null;
createApp({
  setup(){
    const code=ref(''),user=ref(null),people=ref([]),target=ref(null),scores=ref(Array(21).fill(3)),radar=ref(null),shamsiDate=ref('');
    const questions=["Ø¯Ù‚Øª Ùˆ Ú©ÛŒÙÛŒØª Ú©Ø§Ø±","Ø³Ø±Ø¹Øª Ø§Ù†Ø¬Ø§Ù… Ú©Ø§Ø±","Ù‡Ù…Ú©Ø§Ø±ÛŒ ØªÛŒÙ…ÛŒ","Ù…Ø³Ø¦ÙˆÙ„ÛŒØª Ù¾Ø°ÛŒØ±ÛŒ","Ù†ÙˆØ¢ÙˆØ±ÛŒ Ùˆ Ø®Ù„Ø§Ù‚ÛŒØª","Ø§Ù†Ø¶Ø¨Ø§Ø· Ú©Ø§Ø±ÛŒ","Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª Ù…ÙˆØ«Ø±","Ø­Ù„ Ù…Ø³Ø¦Ù„Ù‡","ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ùˆ ØªÙˆØ³Ø¹Ù‡","Ø±Ù‡Ø¨Ø±ÛŒ","Ù…Ø¯ÛŒØ±ÛŒØª Ø²Ù…Ø§Ù†","Ø±Ø¶Ø§ÛŒØª Ù…Ø´ØªØ±ÛŒ","ØªØ¹Ù‡Ø¯ Ø³Ø§Ø²Ù…Ø§Ù†ÛŒ","Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø³ØªØ±Ø³","Ø§Ù†Ø¹Ø·Ø§Ù Ù¾Ø°ÛŒØ±ÛŒ","Ú©Ø§Ø± ØªØ­Øª ÙØ´Ø§Ø±","Ø§Ø±Ø§Ø¦Ù‡ Ú¯Ø²Ø§Ø±Ø´","Ø±Ø¹Ø§ÛŒØª Ø§ÛŒÙ…Ù†ÛŒ","Ø¨Ù‡Ø¨ÙˆØ¯ Ù…Ø³ØªÙ…Ø±","Ù…Ø´Ø§Ø±Ú©Øª Ø¯Ø± Ø¬Ù„Ø³Ø§Øª","Ø­ÙØ¸ Ù…Ø­Ø±Ù…Ø§Ù†Ú¯ÛŒ"];

    const load=()=>{const d=localStorage.getItem('mahrad360');if(d)people.value=JSON.parse(d);else{people.value=[{code:"1001",name:"Ø³ÛŒØ§ÙˆØ´ Ù‚ÙˆÚ†Ø§Ù†ÛŒ",dept:"ÙÙ†ÛŒ",evals:[]},{code:"1004",name:"Ù…Ø­Ù…Ø¯Ø±Ø¶Ø§ Ø´ÙÛŒØ¹ÛŒ",dept:"ÙÙ†ÛŒ",evals:[]}];save();}}
    const save=()=>localStorage.setItem('mahrad360',JSON.stringify(people.value));

    const login=()=>{if(code.value==='admin'){user.value={code:'admin',name:'Ù…Ø¯ÛŒØ±'};return;} const p=people.value.find(x=>x.code===code.value); if(p){user.value=p;draw();}else alert('Ú©Ø¯ Ø§Ø´ØªØ¨Ø§Ù‡');};
    const submit=()=>{target.value.evals=target.value.evals||[];target.value.evals.push({from:user.value.code,scores:[...scores.value]});save();alert('Ø«Ø¨Øª Ø´Ø¯');target.value=null;scores.value=Array(21).fill(3);if(user.value.code!=='admin')draw();};
    const calcAvg=p=>p.evals?.length?p.evals.reduce((a,e)=>a+e.scores.reduce((x,y)=>x+y,0),0)/(p.evals.length*21):0;
    const calcGrade=a=>a>=4.5?'A':a>=4?'B':a>=3.5?'C':a>=3?'D':'E';
    const avg=computed(()=>user.value?.code==='admin'?0:calcAvg(user.value));
    const grade=computed(()=>calcGrade(avg.value));
    const percent=computed(()=>Math.round((avg.value/5)*100));
    const bonus=computed(()=>{let b=avg.value*1500000;return grade.value==='D'?b*0.8:grade.value==='E'?b*0.5:b;});
    const c=452,o=computed(()=>452-(452*percent.value/100));

    const draw=()=>{
      if(chart)chart.destroy();
      const data=user.value?.evals?.length?user.value.evals.reduce((a,e)=>e.scores.map((s,i)=>a[i]=(a[i]||0)+s,a),Array(21).fill(0)).map(v=>v/user.value.evals.length):Array(21).fill(3);
      chart=new Chart(radar.value,{type:'radar',data:{labels:questions,datasets:[
        {label:'Ø¹Ù…Ù„Ú©Ø±Ø¯ ÙØ¹Ù„ÛŒ',data,backgroundColor:'rgba(99,102,241,0.25)',borderColor:'#6366f1',pointBackgroundColor:'#6366f1',borderWidth:4},
        {label:'Ù‡Ø¯Ù',data:Array(21).fill(5),backgroundColor:'rgba(239,68,68,0.15)',borderColor:'#ef4444',borderWidth:3,borderDash:[8,8]}
      ]},options:{scales:{r:{min:0,max:5,ticks:{stepSize:1},grid:{color:'rgba(255,255,255,0.2)'},pointLabels:{color:'#fff',font:{size:13}}}}});
    };

    const exportExcel=()=>{const ws=XLSX.utils.json_to_sheet(people.value.map(p=>({Ù†Ø§Ù…:p.name,ÙˆØ§Ø­Ø¯:p.dept,ØªØ¹Ø¯Ø§Ø¯:p.evals?.length||0,Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†:calcAvg(p).toFixed(2),Ú¯Ø±ÛŒØ¯:calcGrade(calcAvg(p))})));
      const wb=XLSX.utils.book_new();XLSX.utils.book_append_sheet(wb,ws,"Ú¯Ø²Ø§Ø±Ø´");XLSX.writeFile(wb,"Mahrad360.xlsx");};

    const importExcel=e=>{const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=a=>{const wb=XLSX.read(a.target.result);const data=XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);people.value=data.map(x=>({code:String(x.Ú©Ø¯||''),name:x.Ù†Ø§Ù…,dept:x.ÙˆØ§Ø­Ø¯,evals:[]}));save();alert('ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù† Ù…ÙˆÙÙ‚!');};r.readAsArrayBuffer(f);};

    onMounted(()=>{load();setInterval(()=>{const d=new Date();const j=jalaali.toJalaali(d.getFullYear(),d.getMonth()+1,d.getDate());shamsiDate.value=`${j.jy}/${j.jm.toString().padStart(2,'0')}/${j.jd.toString().padStart(2,'0')}`;},1000);});

    return {code,user,people,target,scores,questions,radar,shamsiDate,login,submit,avg,grade,percent,bonus,c,o,draw,exportExcel,importExcel,isAdmin:computed(()=>user.value?.code==='admin'),calcAvg,calcGrade};
  }
}).mount('#app');
</script>
</body>
</html>
